<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anime Community | Freesmart</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
</head>
<body>
  <div id="navbar"></div>
  <script>
    fetch('navbar.html')
      .then(res => res.text())
      .then(html => {
        document.getElementById('navbar').innerHTML = html;
        // Highlight the current tab based on the page
        const navMap = {
          'index.html': 'nav-home',
          'faq.html': 'nav-faq',
          'transport.html': 'nav-transport',
          'anime.html': 'nav-anime',
          'karaoke.html': 'nav-karaoke',
          'videogame.html': 'nav-videogame',
          'boardgame.html': 'nav-boardgame'
        };
        const path = window.location.pathname.split('/').pop();
        const activeId = navMap[path] || 'nav-home';
        const activeLink = document.getElementById(activeId);
        if (activeLink) activeLink.classList.add('active-tab');
      });
  </script>
  <main>
    <div>
      <h1>Anime Community</h1>
      <p>Welcome to the otaku paradise! Connect with fellow anime enthusiasts, discuss your favorite series, share recommendations, and dive deep into the rich world of Japanese animation. From classics to the latest seasonal releases!</p>
      
      <!-- Anime Categories -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin: 2.5rem 0;">
        <div style="background: linear-gradient(135deg, #f8fafc, #e2e8f0); border: 1px solid #cbd5e1; border-radius: 12px; padding: 1.5rem; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <div style="font-size: 2.5rem; margin-bottom: 1rem;">ðŸŽ¬</div>
          <h3 style="color: #1e293b; margin-bottom: 0.5rem;">Seasonal Anime</h3>
          <p style="color: #64748b; font-size: 0.95rem;">Latest releases, seasonal discussions, episode reviews, and trending series.</p>
        </div>
        <div style="background: linear-gradient(135deg, #f8fafc, #e2e8f0); border: 1px solid #cbd5e1; border-radius: 12px; padding: 1.5rem; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <div style="font-size: 2.5rem; margin-bottom: 1rem;">ðŸ“š</div>
          <h3 style="color: #1e293b; margin-bottom: 0.5rem;">Manga & Light Novels</h3>
          <p style="color: #64748b; font-size: 0.95rem;">Source material discussions, recommendations, and adaptation comparisons.</p>
        </div>
        <div style="background: linear-gradient(135deg, #f8fafc, #e2e8f0); border: 1px solid #cbd5e1; border-radius: 12px; padding: 1.5rem; text-align: center; transition: transform 0.3s ease, box-shadow 0.3s ease;">
          <div style="font-size: 2.5rem; margin-bottom: 1rem;">ðŸŽ­</div>
          <h3 style="color: #1e293b; margin-bottom: 0.5rem;">Cosplay & Fan Art</h3>
          <p style="color: #64748b; font-size: 0.95rem;">Creative community, costume making, artwork sharing, and convention meetups.</p>
        </div>
      </div>

      <section id="chatbot-section">
        <h3 style="margin-bottom:1rem;display:flex;align-items:center;gap:1rem;">
          <img src="https://cdn-icons-png.flaticon.com/512/4712/4712139.png" alt="Anime AI" class="chatbot-avatar"> Anime AI Assistant
        </h3>
        <div id="chat-messages" style="min-height:60px;margin-bottom:1rem;"></div>
        <form id="chat-form" style="display:flex;gap:0.5rem;">
          <input id="chat-input" type="text" required />
          <button type="submit">Send</button>
        </form>
        <div id="chat-error" style="color:#ef4444;font-size:0.95rem;margin-top:0.5rem;"></div>
      </section>
    </div>
  </main>
  <script>
    async function query(data) {
      // TODO: Replace YOUR_SPACE and YOUR_CHATFLOW_ID with your own values below
      const response = await fetch(
        "https://jasonhihi-flowise.hf.space/api/v1/prediction/5e51a15f-5ff1-470e-bdd5-0456dd7410a1",
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(data)
        }
      );
      const result = await response.json();
      return result;
    }

    function renderMarkdown(md) {
      let html = md
        .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>')
        .replace(/\*(.*?)\*/g, '<i>$1</i>')
        .replace(/`([^`]+)`/g, '<code>$1</code>')
        .replace(/\n/g, '<br>');
      return html;
    }

    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('chat-form');
      const input = document.getElementById('chat-input');
      const messages = document.getElementById('chat-messages');
      const errorDiv = document.getElementById('chat-error');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const userMsg = input.value.trim();
        if (!userMsg) return;

        messages.innerHTML += `<div class='chat-msg user'><b>You:</b> ${userMsg}</div>`;
        input.value = '';
        errorDiv.textContent = '';

        try {
          messages.innerHTML += `<div class='chat-msg bot' style='color:#888;'><img src="https://cdn-icons-png.flaticon.com/512/4712/4712139.png" width="20" height="20" style="vertical-align:middle;margin-right:0.5rem;"> AnimeBot is typing...</div>`;
          const response = await query({"question": userMsg});
          let botMsg = response.text || JSON.stringify(response);
          
          messages.innerHTML = messages.innerHTML.replace('AnimeBot is typing...','');
          messages.innerHTML += `<div class='chat-msg bot'><img src="https://cdn-icons-png.flaticon.com/512/4712/4712139.png" width="20" height="20" style="vertical-align:middle;margin-right:0.5rem;"><b>AnimeBot:</b> ${renderMarkdown(botMsg)}</div>`;
          messages.scrollTop = messages.scrollHeight;
        } catch (err) {
          errorDiv.textContent = 'Sorry, there was a problem contacting AnimeBot.';
        }
      });
    });
  </script>
  <footer>
    &copy; 2025 Freesmart. Connecting communities intelligently.
  </footer>
